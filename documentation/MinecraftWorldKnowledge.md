# レッドストーン装置設計のためのマイクラ世界知識

本ドキュメントでは、レッドストーン装置を理論的に設計するうえで知っておくべき**マインクラフトの世界知識**を列挙する。特に明文化されにくいが重要な点についても記載する。

## 1. 基本的なゲームルール

- **ゲームバージョン差異**: Java版とBedrock版ではレッドストーン仕様に差異がある。装置設計時はどちらの仕様を前提とするか明確にしておく。
- **ティック(Tick)**: マイクラの基本時間単位。レッドストーンの更新は主にゲームティック(20Hz)で進行する。Java版ではブロック更新順序が保証されていない点に留意。
- **ランダムティック**: 作物成長や葉の腐敗などに使われるティック。レッドストーン装置には直接関与しないが、植林装置などとの組み合わせでは重要。

## 2. チャンクと処理範囲

- **チャンク境界**: 16×16ブロックごとに区切られる領域。チャンク間では更新順序がずれることがあり、装置の安定性に影響する場合がある。
- **チャンクローディング**: プレイヤー周辺やエンティティによりロードされたチャンクのみが処理対象となる。遠隔地の装置を動かすにはチャンクローダー等の仕組みが必要。
- **サブチャンク(高さ毎の16ブロック単位)**: Java版ではY座標ごとにサブチャンクへ分割され、内部処理に利用される。装置規模が大きい場合にメモリやパフォーマンスへ影響する。

## 3. レッドストーン信号の基礎

- **信号強度**: レバーやトーチの強度は15。ダストは1ブロックごとに減衰し0になると無効化。
- **RSダストの更新順序**: ブロック周辺のRSダストの形状・向きは、置いた順番や隣接更新の順序で変化し得る。複雑な回路では意図せぬ形になる可能性あり。
- **ダイオード的性質**: リピータの入力側は裏面、出力側は表面。リピータを用いることで信号遅延と整流が可能。

## 4. 主なレッドストーンコンポーネントの仕様

以下では各コンポーネントについて、
**設置・プレイヤー操作**、**周囲からの入力による状態変化**、
**周囲への出力**の三点から整理する。

### レッドストーンダスト
- **設置・操作**: ブロック上面の1ブロック空間を占有。クリックで設置方向を変えることはできず、周囲の接続状況に応じて自動的に形状が決まる。階段状に配置すれば1ブロックずつ上昇できるが、垂直接続は不可。
- **入力による変化**: 接続されたダストや信号源から最大15の強度を受け取り、隣接するごとに1ずつ減衰して伝達する。周囲ブロックの更新で形状も再計算される。
- **出力**: 接続した隣接ブロックすべてへ現在の強度を出力。1ブロック高低差まで斜め伝達できるが下方向へは流れない。

### レッドストーントーチ
- **設置・操作**: ブロックの上面または側面に設置できる。下面には付かず、設置時点で点灯状態となる。
- **入力による変化**: 設置先のブロックがハードパワーされるとトーチは消灯し、無電源になると点灯する。
- **出力**: 点灯時は周囲の隣接面すべてに強度15を出力。設置面の反対側にも出力されるため垂直伝達に便利。

### レバー
- **設置・操作**: ブロックの側面や上面に設置し、右クリックでオン・オフを切り替える。向きは設置時に決定される。
- **入力による変化**: レバー自身は外部入力で状態が変わることはない。オンの間は信号を維持する。
- **出力**: 接続ブロックを強くパワーし、レバーの向きに沿った前方1マスへ強度15を出力する。

### ボタン
- **設置・操作**: ブロックの側面や上面に設置でき、右クリックや矢などの当たりで押下される。木製は約30Tick、石製は約20Tick保持。
- **入力による変化**: 外部からの信号で押下状態は変化しない。押下中は自動でタイマーが進み、時間経過で戻る。
- **出力**: 押下中のみ接続先ブロックへ強度15を出力し、前面1ブロックに伝達する。

### 感圧板
- **設置・操作**: ブロック上面にのみ設置可能。Entityが乗ると押下状態となり、降りると戻る。材質により反応対象が変わる。
- **入力による変化**: Entityの乗降がトリガーとなり、押下中は状態を維持する。
- **出力**: 押下中に設置ブロックを強くパワーし、下方向や隣接面へ強度15を出力する。

### レッドストーンブロック
- **設置・操作**: 固体ブロックとして自由に設置でき、ピストンで移動させられる。プレイヤー操作で状態は変化しない。
- **入力による変化**: 常に強度15を保つため外部入力の影響を受けない。
- **出力**: 六面すべてに常時強度15の信号を出力する。

### リピータ
- **設置・操作**: ブロック上面にのみ設置可能。クリックで遅延(1～4Tick)を変更でき、向きは設置時に決まる。
- **入力による変化**: 背面からの信号が1以上になると設定遅延後に出力がオンになり、入力が切れると即座にオフになる。
- **出力**: 前面1ブロックにのみ整流された信号を出力。遅延中は内部タイマーを持つ。

### コンパレーター
- **設置・操作**: ブロック上面に設置し、背面と左右の向きがある。クリックで比較/減算モードを切り替える。
- **入力による変化**: 背面入力と左右入力の強度を比較して出力値を計算する。ホッパーやチェストからアイテム量に応じた信号も取得可能。
- **出力**: 前面に計算結果の信号強度(0～15)を出力する。0の場合は出力しない。

### ピストン / 粘着ピストン
- **設置・操作**: 向きを決めて設置。プレイヤー操作で直接伸縮はできない。粘着ピストンはブロックを引き戻す。
- **入力による変化**: 側面や背面から信号を受け取ると伸び、信号が切れると縮む。黒曜石など一部ブロックは押せない。
- **出力**: 信号自体は出さないが、ブロックを移動させることで回路に物理的変化を与える。

### ディスペンサー / ドロッパー
- **設置・操作**: 正面方向を決めて設置。GUIでアイテムを出し入れでき、外部操作で中身は変わらない。
- **入力による変化**: 隣接からの信号で一度だけ内容物を発射。ドロッパーはアイテムをそのまま排出し、ディスペンサーは使用効果を伴う。
- **出力**: アイテムを射出する以外の信号は出力しない。

### 観察者 (オブザーバー)
- **設置・操作**: 正面と背面の向きが固定され、設置時に向きを決定する。プレイヤー操作で向き変更はできない。
- **入力による変化**: 正面のブロック更新を検知すると1Tickだけ出力状態となる。
- **出力**: 背面から強度15の短いパルスを出力し、横方向へは出力しない。

## 5. 代表的な機構・仕様

- **クワジー(Quasi-Connectivity)**: ブロック上部1ブロック上にある装置にも信号が伝わるJava版の仕様。ピストンや発射装置等に影響し、複雑な装置を実現する鍵。
- **ゼロティック(Zero-tick)回路**: ピストンやブロック更新を利用して、通常よりも短いタイミングで作物成長やアイテム移動を行う手法。バージョン依存で動作が変化する点に注意。
- **BUD(Block Update Detector)**: ブロック更新を検知する機構。ピストンの特性を利用して隣接ブロックの変化を感知できる。
- **ハードパワーとソフトパワー**: トーチ・リピータなどが直接ブロックに与える「ハードパワー」と、ダスト経由などでブロック面に与える「ソフトパワー」が存在。特定の装置はハードパワーのみ受け付ける。
- **マグマ・水流によるアイテム移動**: 水流でのアイテム輸送、マグマを利用した燃焼処理など、流体の挙動はアップデート毎に微妙に変化するため注意。

## 6. エンティティ関連

- **アイテム化したブロック**: アイテムEntityはランダムティックや水流等に影響を受ける。回収装置ではホッパー範囲外へ飛び散らないよう制御する。
- **Mobの当たり判定とRS信号**: プレッシャープレートやトリップワイヤーはMobの大きさや種類により挙動が変わることがある。特にVillagerの処理装置では挙動確認が必須。

## 7. 処理負荷と最適化

- **レッドストーンの遅延**: RS回路が大量にあるとサーバー/クライアントの負荷が増す。クロック回路や常時稼働装置は特に負荷が高く、設計段階から最小化を意識する。
- **エンティティ数上限**: アイアンゴーレムトラップやMobファームではエンティティ数の上限に達する恐れがある。チャンク分散や処理装置の間隔調整が有効。
- **ラグフリー設計**: 観察者ブロックやコンパレーターによるクロックよりも、必要最小限の更新で動作させる。遅延回路の試算やシミュレーションを行うとよい。

## 8. バージョン依存・明文化されにくい要素

- **アップデートによる仕様変更**: 製品版リリース後もメジャーアップデートでRS挙動が変更されることがある。過去の設計資料をそのまま流用する際は必ずバージョンを明記する。
- **不具合依存の手法**: いわゆるバグ技 (無限増殖・Duplicationなど) は修正される可能性が高い。理論設計では再現性・メンテナンス性を考慮し、利用可否を判断する。
- **サーバーによる挙動差**: マルチプレイ向けのサーバー実装(Spigot/Paper等)では独自の最適化が施されていることが多く、純正と同じ動作をしない場合がある。

## 9. 実践的な注意点

- **デバッグ方法**: F3デバッグ画面でチャンク境界やブロックの向き、RS信号強度を確認できる。設計段階でスクリーンショットや動画を残すと後から検証しやすい。
- **ワールドバックアップ**: 実装前にバックアップを取ること。特にゼロティックや大量のエンティティを扱う装置はワールド破損のリスクがある。
- **バージョン管理**: 複数人で装置開発を行う場合、ワールドデータや設計図のバージョンを管理し、変更点を記録する仕組みを整える。

## 10. 参考リンク

- [Minecraft Fandom Wiki](https://minecraft.fandom.com/ja/wiki/Java_Edition) - 詳細な仕様まとめ
- [日本Minecraftフォーラム](https://forum.minecraft.jp/) - 最新情報やテクニック共有


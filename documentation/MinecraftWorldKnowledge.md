# レッドストーン装置設計のためのマイクラ世界知識

本ドキュメントでは、レッドストーン装置を理論的に設計するうえで知っておくべき**マインクラフトの世界知識**を列挙する。特に明文化されにくいが重要な点についても記載する。

## 1. 基本的なゲームルール

- **ゲームバージョン差異**: Java版とBedrock版ではレッドストーン仕様に差異がある。装置設計時はどちらの仕様を前提とするか明確にしておく。
- **ティック(Tick)**: マイクラの基本時間単位。レッドストーンの更新は主にゲームティック(20Hz)で進行する。Java版ではブロック更新順序が保証されていない点に留意。
- **ランダムティック**: 作物成長や葉の腐敗などに使われるティック。レッドストーン装置には直接関与しないが、植林装置などとの組み合わせでは重要。

## 2. チャンクと処理範囲

- **チャンク境界**: 16×16ブロックごとに区切られる領域。チャンク間では更新順序がずれることがあり、装置の安定性に影響する場合がある。
- **チャンクローディング**: プレイヤー周辺やエンティティによりロードされたチャンクのみが処理対象となる。遠隔地の装置を動かすにはチャンクローダー等の仕組みが必要。
- **サブチャンク(高さ毎の16ブロック単位)**: Java版ではY座標ごとにサブチャンクへ分割され、内部処理に利用される。装置規模が大きい場合にメモリやパフォーマンスへ影響する。

## 3. レッドストーン信号の基礎

- **信号強度**: レバーやトーチの強度は15。ダストは1ブロックごとに減衰し0になると無効化。
- **RSダストの更新順序**: ブロック周辺のRSダストの形状・向きは、置いた順番や隣接更新の順序で変化し得る。複雑な回路では意図せぬ形になる可能性あり。
- **ダイオード的性質**: リピータの入力側は裏面、出力側は表面。リピータを用いることで信号遅延と整流が可能。

## 4. レッドストーン装置関連コンポーネントの仕様

以下では各コンポーネントについて、
**設置・プレイヤー操作**、**周囲からの入力による状態変化**、
**周囲への出力**の三点から整理する。

### レッドストーンダスト
- **設置・操作**: ブロック上面の1ブロック空間を占有。クリックで設置方向を変えることはできず、周囲の接続状況に応じて自動的に形状が決まる。階段状に配置すれば1ブロックずつ上昇できるが、垂直接続は不可。
- **入力による変化**: 接続されたダストや信号源から最大15の強度を受け取り、隣接するごとに1ずつ減衰して伝達する。周囲ブロックの更新で形状も再計算される。
- **出力**: 接続した隣接ブロックすべてへ現在の強度を出力。1ブロック高低差まで斜め伝達できるが下方向へは流れない。

### レッドストーントーチ
- **設置・操作**: ブロックの上面または側面に設置できる。下面には付かず、設置時点で点灯状態となる。
- **入力による変化**: 設置先のブロックがハードパワーされるとトーチは消灯し、無電源になると点灯する。
- **出力**: 点灯時は周囲の隣接面すべてに強度15を出力。設置面の反対側にも出力されるため垂直伝達に便利。

### レバー
- **設置・操作**: ブロックの側面や上面に設置し、右クリックでオン・オフを切り替える。向きは設置時に決定される。
- **入力による変化**: レバー自身は外部入力で状態が変わることはない。オンの間は信号を維持する。
- **出力**: 接続ブロックを強くパワーし、レバーの向きに沿った前方1マスへ強度15を出力する。

### ボタン
- **設置・操作**: ブロックの側面や上面に設置でき、右クリックや矢などの当たりで押下される。木製は約30Tick、石製は約20Tick保持。
- **入力による変化**: 外部からの信号で押下状態は変化しない。押下中は自動でタイマーが進み、時間経過で戻る。
- **出力**: 押下中のみ接続先ブロックへ強度15を出力し、前面1ブロックに伝達する。

### 感圧板
- **設置・操作**: ブロック上面にのみ設置可能。Entityが乗ると押下状態となり、降りると戻る。材質により反応対象が変わる。
- **入力による変化**: Entityの乗降がトリガーとなり、押下中は状態を維持する。
- **出力**: 押下中に設置ブロックを強くパワーし、下方向や隣接面へ強度15を出力する。

### レッドストーンブロック
- **設置・操作**: 固体ブロックとして自由に設置でき、ピストンで移動させられる。プレイヤー操作で状態は変化しない。
- **入力による変化**: 常に強度15を保つため外部入力の影響を受けない。
- **出力**: 六面すべてに常時強度15の信号を出力する。

### リピータ
- **設置・操作**: ブロック上面にのみ設置可能。クリックで遅延(1～4Tick)を変更でき、向きは設置時に決まる。
- **入力による変化**: 背面からの信号が1以上になると設定遅延後に出力がオンになり、入力が切れると即座にオフになる。
- **出力**: 前面1ブロックにのみ整流された信号を出力。遅延中は内部タイマーを持つ。

### コンパレーター
- **設置・操作**: ブロック上面に設置し、背面と左右の向きがある。クリックで比較/減算モードを切り替える。
- **入力による変化**: 背面入力と左右入力の強度を比較して出力値を計算する。ホッパーやチェストからアイテム量に応じた信号も取得可能。
- **出力**: 前面に計算結果の信号強度(0～15)を出力する。0の場合は出力しない。

### ピストン / 粘着ピストン
- **設置・操作**: 向きを決めて設置。プレイヤー操作で直接伸縮はできない。粘着ピストンはブロックを引き戻す。
- **入力による変化**: 側面や背面から信号を受け取ると伸び、信号が切れると縮む。黒曜石など一部ブロックは押せない。
- **出力**: 信号自体は出さないが、ブロックを移動させることで回路に物理的変化を与える。

### ディスペンサー / ドロッパー
- **設置・操作**: 正面方向を決めて設置。GUIでアイテムを出し入れでき、外部操作で中身は変わらない。
- **入力による変化**: 隣接からの信号で一度だけ内容物を発射。ドロッパーはアイテムをそのまま排出し、ディスペンサーは使用効果を伴う。
- **出力**: アイテムを射出する以外の信号は出力しない。

### 観察者 (オブザーバー)
- **設置・操作**: 正面と背面の向きが固定され、設置時に向きを決定する。プレイヤー操作で向き変更はできない。
- **入力による変化**: 正面のブロック更新を検知すると1Tickだけ出力状態となる。
- **出力**: 背面から強度15の短いパルスを出力し、横方向へは出力しない。

### 日照センサー
- **設置・操作**: ブロック上面に設置し、右クリックで昼夜モードを切り替えられる。
- **入力による変化**: 周囲の明るさに応じて0～15の強度を出力する。
- **出力**: 現在の強度を隣接ブロックへ伝える。

### トリップワイヤーフック
- **設置・操作**: 向かい合った壁面に2つ設置し、間を糸で接続する。糸が切れると解除される。
- **入力による変化**: 糸にEntityが触れるとオンになり、離れるとオフになる。
- **出力**: オンの間、両端のフックから強度15を出力。

### 軽量感圧版
- **設置・操作**: 金の感圧版。ブロック上面に置く。
- **入力による変化**: 上のアイテム数に応じて0～15の強度を生成する。
- **出力**: 設置ブロックを強くパワーする。

### 重量感圧版
- **設置・操作**: 鉄の感圧版。ブロック上面に置く。
- **入力による変化**: アイテム数を10個単位で計測し強度0～15を出力する。
- **出力**: 強度に応じて設置面へ信号を伝える。

### ホッパー
- **設置・操作**: 上面からアイテムを吸い込み、側面の向きに排出するインベントリを持つ。
- **入力による変化**: 動力が加わると吸い込みと搬出が停止する。
- **出力**: コンパレーターで内部アイテム量を検知できる。

### トロッコ
- **設置・操作**: レール上に設置し乗車や押すことで移動する。
- **入力による変化**: パワードレールや傾斜で速度が変化する。
- **出力**: ディテクターレール通過時に信号を発生させる。

### チェスト付きトロッコ
- **設置・操作**: チェストを積んだトロッコで、アイテムの運搬に使う。
- **入力による変化**: ホッパーやパワードレールの影響を受ける。
- **出力**: ディテクターレールで中身をコンパレーターが読み取れる。

### かまど付きトロッコ
- **設置・操作**: かまどを積み、燃料を入れると自走する。
- **入力による変化**: 燃料がある間は前進し続け、信号では停止しない。
- **出力**: 特に信号は出さない。

### ホッパー付きトロッコ
- **設置・操作**: ホッパーを積んだトロッコで、走行中も周囲のアイテムを回収する。
- **入力による変化**: 動力レールで速度調整が可能。
- **出力**: コンパレーターで中身を検知できる。

### TNT付きトロッコ
- **設置・操作**: TNTを積んだトロッコ。アクティベーターレール等で着火する。
- **入力による変化**: 着火後しばらくして爆発し、衝突や落下でも爆発する。
- **出力**: 爆発による破壊効果のみ。

### コマンドブロック付きトロッコ
- **設置・操作**: クリエイティブモード限定で設置でき、コマンドを保持する。
- **入力による変化**: アクティベーターレールを通過するとコマンドを実行。
- **出力**: 実行結果以外の信号はない。

### レール
- **設置・操作**: ブロック上面に設置し、隣接状況に応じて曲線や斜面へ変化する。
- **入力による変化**: 信号の有無で形状は変わらない。
- **出力**: 信号は出さないがトロッコの走路となる。

### パワードレール
- **設置・操作**: 動力が入るとトロッコを加速し、無いと減速させる。
- **入力による変化**: レッドストーン信号でオン・オフが切り替わる。
- **出力**: 信号自体は出力しない。

### アクティベーターレール
- **設置・操作**: 信号を受けた状態で通過したトロッコに特殊効果を与えるレール。
- **入力による変化**: パワード時にTNT付きトロッコの着火などを行う。
- **出力**: 出力は行わない。

### ディテクターレール
- **設置・操作**: トロッコが上に乗ると感知するレール。
- **入力による変化**: トロッコが存在する間のみオンになる。
- **出力**: 強度15の信号を隣接ブロックへ送る。

### TNT
- **設置・操作**: ブロックとして置き、信号や火で起爆する。
- **入力による変化**: 点火後約4秒で爆発する。
- **出力**: 爆発によるブロック破壊が発生する。

### 音符ブロック
- **設置・操作**: ブロック上に設置し、右クリックで音階を変更できる。
- **入力による変化**: 信号を受けると設定した音を鳴らす。
- **出力**: 音を再生する以外の信号はない。

### 非透過ブロック
- **設置・操作**: 石や土など光を通さないブロックで、レバー等を取り付けられる。
- **入力による変化**: ハードパワーされると内部に信号を保持する。
- **出力**: 隣接面へ強い信号を伝達できる。

### 透過ブロック
- **設置・操作**: ガラスや葉などの光を通すブロック。RS部品を設置できないものが多い。
- **入力による変化**: 信号を保持しないため伝達を遮断する。
- **出力**: 信号を出さず、配線を分離する用途に使われる。

### スライムブロック
- **設置・操作**: ピストンで押すと周囲のブロックをまとめて動かせる特性を持つ。
- **入力による変化**: 移動時に上のEntityを跳ねさせる。
- **出力**: 信号は出さないがブロック移動機構の中心となる。

### 不動ブロック
- **設置・操作**: オブシディアンなどピストンやスライムブロックで動かないブロック。
- **入力による変化**: 押されても位置が変わらない。
- **出力**: 通常のブロック同様に信号を伝えるが移動はしない。

### トラップチェスト
- **設置・操作**: チェストとして設置でき、開くと信号を出す。
- **入力による変化**: 開閉に応じて信号の有無が変わる。
- **出力**: コンパレーターで中身の量を読み取ることも可能。

### ピストンで動かせないブロック
- **設置・操作**: 黒曜石やエンドポータルフレームなど。
- **入力による変化**: ピストンやスライムブロックで押しても動かない。
- **出力**: 信号伝達は通常通り行える。

### 階段・ハーフブロック
- **設置・操作**: 上付きで置けばRSダストを切らずに配線でき、フルブロック面にはレバー等を付けられる。
- **入力による変化**: ブロック内部で信号を保持しない。
- **出力**: 出力自体はなく、配線のための形状として利用される。

### レッドストーンランプ
- **設置・操作**: 固体ブロックとして設置でき、装飾や照明に使われる。
- **入力による変化**: 信号を受けると点灯し、切れると消灯する。
- **出力**: 信号は出さないが明るさを提供する。

### トラップドア、フェンスゲート、ドア
- **設置・操作**: いずれも設置後にプレイヤー操作または信号で開閉できる。
- **入力による変化**: レッドストーン信号を受けると開閉状態が切り替わる。
- **出力**: 出力はしないが、状態変化で通行や光を制御する。

## 5. 代表的な機構・仕様

- **クワジー(Quasi-Connectivity)**: ブロック上部1ブロック上にある装置にも信号が伝わるJava版の仕様。ピストンや発射装置等に影響し、複雑な装置を実現する鍵。
- **ゼロティック(Zero-tick)回路**: ピストンやブロック更新を利用して、通常よりも短いタイミングで作物成長やアイテム移動を行う手法。バージョン依存で動作が変化する点に注意。
- **BUD(Block Update Detector)**: ブロック更新を検知する機構。ピストンの特性を利用して隣接ブロックの変化を感知できる。
- **ハードパワーとソフトパワー**: トーチ・リピータなどが直接ブロックに与える「ハードパワー」と、ダスト経由などでブロック面に与える「ソフトパワー」が存在。特定の装置はハードパワーのみ受け付ける。
- **マグマ・水流によるアイテム移動**: 水流でのアイテム輸送、マグマを利用した燃焼処理など、流体の挙動はアップデート毎に微妙に変化するため注意。

## 6. エンティティ関連

- **アイテム化したブロック**: アイテムEntityはランダムティックや水流等に影響を受ける。回収装置ではホッパー範囲外へ飛び散らないよう制御する。
- **Mobの当たり判定とRS信号**: プレッシャープレートやトリップワイヤーはMobの大きさや種類により挙動が変わることがある。特にVillagerの処理装置では挙動確認が必須。

## 7. 処理負荷と最適化

- **レッドストーンの遅延**: RS回路が大量にあるとサーバー/クライアントの負荷が増す。クロック回路や常時稼働装置は特に負荷が高く、設計段階から最小化を意識する。
- **エンティティ数上限**: アイアンゴーレムトラップやMobファームではエンティティ数の上限に達する恐れがある。チャンク分散や処理装置の間隔調整が有効。
- **ラグフリー設計**: 観察者ブロックやコンパレーターによるクロックよりも、必要最小限の更新で動作させる。遅延回路の試算やシミュレーションを行うとよい。

## 8. バージョン依存・明文化されにくい要素

- **アップデートによる仕様変更**: 製品版リリース後もメジャーアップデートでRS挙動が変更されることがある。過去の設計資料をそのまま流用する際は必ずバージョンを明記する。
- **不具合依存の手法**: いわゆるバグ技 (無限増殖・Duplicationなど) は修正される可能性が高い。理論設計では再現性・メンテナンス性を考慮し、利用可否を判断する。
- **サーバーによる挙動差**: マルチプレイ向けのサーバー実装(Spigot/Paper等)では独自の最適化が施されていることが多く、純正と同じ動作をしない場合がある。

## 9. 実践的な注意点

- **デバッグ方法**: F3デバッグ画面でチャンク境界やブロックの向き、RS信号強度を確認できる。設計段階でスクリーンショットや動画を残すと後から検証しやすい。
- **ワールドバックアップ**: 実装前にバックアップを取ること。特にゼロティックや大量のエンティティを扱う装置はワールド破損のリスクがある。
- **バージョン管理**: 複数人で装置開発を行う場合、ワールドデータや設計図のバージョンを管理し、変更点を記録する仕組みを整える。

## 10. 参考リンク

- [Minecraft Fandom Wiki](https://minecraft.fandom.com/ja/wiki/Java_Edition) - 詳細な仕様まとめ
- [日本Minecraftフォーラム](https://forum.minecraft.jp/) - 最新情報やテクニック共有


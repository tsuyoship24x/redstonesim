# レッドストーン装置設計のためのマイクラ世界知識

本ドキュメントでは、レッドストーン装置を理論的に設計するうえで知っておくべき**マインクラフトの世界知識**を列挙する。特に明文化されにくいが重要な点についても記載する。

## 1. 基本的なゲームルール

- **ゲームバージョン差異**: Java版とBedrock版ではレッドストーン仕様に差異がある。装置設計時はどちらの仕様を前提とするか明確にしておく。
- **ティック(Tick)**: マイクラの基本時間単位。レッドストーンの更新は主にゲームティック(20Hz)で進行する。Java版ではブロック更新順序が保証されていない点に留意。
- **ランダムティック**: 作物成長や葉の腐敗などに使われるティック。レッドストーン装置には直接関与しないが、植林装置などとの組み合わせでは重要。

## 2. チャンクと処理範囲

- **チャンク境界**: 16×16ブロックごとに区切られる領域。チャンク間では更新順序がずれることがあり、装置の安定性に影響する場合がある。
- **チャンクローディング**: プレイヤー周辺やエンティティによりロードされたチャンクのみが処理対象となる。遠隔地の装置を動かすにはチャンクローダー等の仕組みが必要。
- **サブチャンク(高さ毎の16ブロック単位)**: Java版ではY座標ごとにサブチャンクへ分割され、内部処理に利用される。装置規模が大きい場合にメモリやパフォーマンスへ影響する。

## 3. レッドストーン信号の基礎

- **信号強度**: レバーやトーチの強度は15。ダストは1ブロックごとに減衰し0になると無効化。
- **RSダストの更新順序**: ブロック周辺のRSダストの形状・向きは、置いた順番や隣接更新の順序で変化し得る。複雑な回路では意図せぬ形になる可能性あり。
- **ダイオード的性質**: リピータの入力側は裏面、出力側は表面。リピータを用いることで信号遅延と整流が可能。

## 4. 主なレッドストーンコンポーネントの仕様

- **レッドストーンダスト**: 周囲の接続状況に応じて形状が変化する。階段状に配置すれば1ブロックずつ上昇できるが、垂直にはつながらない。
- **レッドストーントーチ**: ブロックの上面または側面に設置可能で、下面には付けられない。通常は強度15で信号を出力し、設置先ブロックがパワーされると消灯する。
- **レバー**: 接続したブロックを強度15の信号源にし、レバーの上下および四方向へ1マスずつ強度15の信号を出力する。
- **ボタン**: 木製は約30Tick、石製は約20Tickだけ信号を出力。いずれも接続ブロックを強くパワーするが、矢などで起動できるのは木製のみ。
- **感圧板**: 木・石・鉄・金など種類により反応対象が異なる。上に乗ったエンティティを検知して強度15の信号を出力する。
- **レッドストーンブロック**: 常時強度15の信号を出力する固体ブロック。ピストンで移動可能な信号源として多用される。
- **リピータ**: 信号の整流と遅延を行う。一方向のみ伝達し、遅延時間は1～4Tickで設定できる。
- **コンパレーター**: 背面入力と左右入力を比較して出力を決定する。アイテム量に応じた信号強度を取得する用途も多い。
- **ピストン/粘着ピストン**: 前面のブロックを押し出し、粘着ピストンは引き戻しも行う。黒曜石など一部ブロックは動かせない。
- **ディスペンサー/ドロッパー**: 前者はアイテムを使用した形で射出し、後者はアイテム化して排出する。
- **観察者(オブザーバー)**: 正面のブロック更新を検知し、背面から1Tickのパルスを出力する。向きを誤ると作動しない。

## 5. 代表的な機構・仕様

- **クワジー(Quasi-Connectivity)**: ブロック上部1ブロック上にある装置にも信号が伝わるJava版の仕様。ピストンや発射装置等に影響し、複雑な装置を実現する鍵。
- **ゼロティック(Zero-tick)回路**: ピストンやブロック更新を利用して、通常よりも短いタイミングで作物成長やアイテム移動を行う手法。バージョン依存で動作が変化する点に注意。
- **BUD(Block Update Detector)**: ブロック更新を検知する機構。ピストンの特性を利用して隣接ブロックの変化を感知できる。
- **ハードパワーとソフトパワー**: トーチ・リピータなどが直接ブロックに与える「ハードパワー」と、ダスト経由などでブロック面に与える「ソフトパワー」が存在。特定の装置はハードパワーのみ受け付ける。
- **マグマ・水流によるアイテム移動**: 水流でのアイテム輸送、マグマを利用した燃焼処理など、流体の挙動はアップデート毎に微妙に変化するため注意。

## 6. エンティティ関連

- **アイテム化したブロック**: アイテムEntityはランダムティックや水流等に影響を受ける。回収装置ではホッパー範囲外へ飛び散らないよう制御する。
- **Mobの当たり判定とRS信号**: プレッシャープレートやトリップワイヤーはMobの大きさや種類により挙動が変わることがある。特にVillagerの処理装置では挙動確認が必須。

## 7. 処理負荷と最適化

- **レッドストーンの遅延**: RS回路が大量にあるとサーバー/クライアントの負荷が増す。クロック回路や常時稼働装置は特に負荷が高く、設計段階から最小化を意識する。
- **エンティティ数上限**: アイアンゴーレムトラップやMobファームではエンティティ数の上限に達する恐れがある。チャンク分散や処理装置の間隔調整が有効。
- **ラグフリー設計**: 観察者ブロックやコンパレーターによるクロックよりも、必要最小限の更新で動作させる。遅延回路の試算やシミュレーションを行うとよい。

## 8. バージョン依存・明文化されにくい要素

- **アップデートによる仕様変更**: 製品版リリース後もメジャーアップデートでRS挙動が変更されることがある。過去の設計資料をそのまま流用する際は必ずバージョンを明記する。
- **不具合依存の手法**: いわゆるバグ技 (無限増殖・Duplicationなど) は修正される可能性が高い。理論設計では再現性・メンテナンス性を考慮し、利用可否を判断する。
- **サーバーによる挙動差**: マルチプレイ向けのサーバー実装(Spigot/Paper等)では独自の最適化が施されていることが多く、純正と同じ動作をしない場合がある。

## 9. 実践的な注意点

- **デバッグ方法**: F3デバッグ画面でチャンク境界やブロックの向き、RS信号強度を確認できる。設計段階でスクリーンショットや動画を残すと後から検証しやすい。
- **ワールドバックアップ**: 実装前にバックアップを取ること。特にゼロティックや大量のエンティティを扱う装置はワールド破損のリスクがある。
- **バージョン管理**: 複数人で装置開発を行う場合、ワールドデータや設計図のバージョンを管理し、変更点を記録する仕組みを整える。

## 10. 参考リンク

- [Minecraft Fandom Wiki](https://minecraft.fandom.com/ja/wiki/Java_Edition) - 詳細な仕様まとめ
- [日本Minecraftフォーラム](https://forum.minecraft.jp/) - 最新情報やテクニック共有

